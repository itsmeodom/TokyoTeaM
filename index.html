<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Points of Interest</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 500px;
        }
        #poi-list {
            list-style-type: none;
            padding: 0;
        }
        .poi-item {
            margin: 10px 0;
        }
        .controls {
            margin: 20px 0;
        }
        .leaflet-control-layers {
            background-color: white;
        }
    </style>
</head>
<body>

<div class="controls">
    <input type="text" id="search" placeholder="Search points of interest">
    <select id="filter">
        <option value="all">All</option>
        <option value="restaurant">Restaurants</option>
        <option value="museum">Museums</option>
        <option value="park">Parks</option>
        <option value="hotel">Hotels</option>
        <option value="general">General</option>
    </select>
    <button onclick="toggleView()">Toggle List/Map View</button>
    <button onclick="zoomToCurrentLocation()">Zoom to Current Location</button>
</div>

<div id="map"></div>
<ul id="poi-list" style="display: none;"></ul>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    const accessToken = '<your accessToken>'; // Replace with your Jawg access token

    var Jawg_Streets = L.tileLayer('https://tile.jawg.io/jawg-streets/{z}/{x}/{y}{r}.png?access-token=' + accessToken, {
        attribution: '<a href="https://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        minZoom: 0,
        maxZoom: 22,
    });

    var Jawg_Dark = L.tileLayer('https://tile.jawg.io/jawg-dark/{z}/{x}/{y}{r}.png?access-token=' + accessToken, {
        attribution: '<a href="https://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        minZoom: 0,
        maxZoom: 22,
    });

    var Jawg_Terrain = L.tileLayer('https://tile.jawg.io/jawg-terrain/{z}/{x}/{y}{r}.png?access-token=' + accessToken, {
        attribution: '<a href="https://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        minZoom: 0,
        maxZoom: 22,
    });

    let mapView = true; // Start with map view

    // Initialize the map
    const map = L.map('map').setView([35.6762, 139.6503], 13); // Centered on Tokyo, Japan

    // Add default basemap
    Jawg_Streets.addTo(map);

    const baseMaps = {
        "Jawg Streets": Jawg_Streets,
        "Jawg Dark": Jawg_Dark,
        "Jawg Terrain": Jawg_Terrain
    };

    L.control.layers(baseMaps).addTo(map);

    // Define colors for different POI types
    const colors = {
        park: 'green',
        hotel: 'blue',
        restaurant: 'red',
        museum: 'purple',
        general: 'orange'
    };

    // Function to create colored markers
    function createColoredMarker(color) {
        const svgIcon = `
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="${color}">
                <path d="M16 0C10.477 0 6 4.477 6 10c0 4.923 4.685 11.33 9.004 17.694.36.541.97.878 1.635.879.667.001 1.277-.337 1.637-.88C21.316 21.33 26 14.923 26 10c0-5.523-4.477-10-10-10zm0 15a5 5 0 110-10 5 5 0 010 10z"/>
            </svg>`;
        return L.divIcon({
            html: svgIcon,
            className: '',
            iconSize: [32, 32],
            iconAnchor: [16, 32],
            popupAnchor: [0, -32]
        });
    }

    // Fetch POIs from external JSON file
    fetch('pois.json')
        .then(response => response.json())
        .then(pois => {
            // Add markers to the map
            const markers = [];
            pois.forEach(poi => {
                const popupContent = `
                    <b>${poi.name}</b><br>
                    ${poi.notes}<br>
                    <a href="${poi.link}" target="_blank">More info</a><br>
                    <a href="${poi.googleMapsLink}" target="_blank">Open in Google Maps</a>
                `;
                const marker = L.marker([poi.lat, poi.lng], { icon: createColoredMarker(colors[poi.type]) }).bindPopup(popupContent);
                markers.push(marker);
                marker.addTo(map);
            });

            // Display POIs as a list
            const poiList = document.getElementById('poi-list');
            pois.forEach(poi => {
                const listItem = document.createElement('li');
                listItem.className = 'poi-item';
                listItem.innerHTML = `
                    <b>${poi.name}</b><br>
                    ${poi.notes}<br>
                    <a href="${poi.link}" target="_blank">More info</a><br>
                    <a href="${poi.googleMapsLink}" target="_blank">Open in Google Maps</a>
                `;
                poiList.appendChild(listItem);
            });

            // Filter POIs
            document.getElementById('filter').addEventListener('change', () => updateMapAndList(pois, markers));
            document.getElementById('search').addEventListener('input', () => updateMapAndList(pois, markers));
            map.on('moveend', () => updateMapAndList(pois, markers));

            // Initial update
            updateMapAndList(pois, markers);
        });

    // Toggle between map and list view
    function toggleView() {
        mapView = !mapView;
        document.getElementById('map').style.display = mapView ? 'block' : 'none';
        document.getElementById('poi-list').style.display = mapView ? 'none' : 'block';
    }

    // Zoom to current location
    function zoomToCurrentLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(position => {
                const { latitude, longitude } = position.coords;
                map.setView([latitude, longitude], 13);
            }, () => {
                alert('Geolocation is not supported by this browser.');
            });
        } else {
            alert('Geolocation is not supported by this browser.');
        }
    }

    // Update POI list and markers based on filter, search, and map bounds
    function updateMapAndList(pois, markers) {
        const filterValue = document.getElementById('filter').value;
        const searchValue = document.getElementById('search').value.toLowerCase();
        const bounds = map.getBounds();
        const poiList = document.getElementById('poi-list');
        poiList.innerHTML = '';

        markers.forEach(marker => marker.remove());

        pois.forEach((poi, index) => {
            const isInBounds = bounds.contains([poi.lat, poi.lng]);
            const matchesFilter = filterValue === 'all' || poi.type === filterValue;
            const matchesSearch = poi.name.toLowerCase().includes(searchValue);

            if (isInBounds && matchesFilter && matchesSearch) {
                markers[index].addTo(map);
                const listItem = document.createElement('li');
                listItem.className = 'poi-item';
                listItem.innerHTML = `
                    <b>${poi.name}</b><br>
                    ${poi.notes}<br>
                    <a href="${poi.link}" target="_blank">More info</a><br>
                    <a href="${poi.googleMapsLink}" target="_blank">Open in Google Maps</a>
                `;
                poiList.appendChild(listItem);
            }
        });
    }
</script>

</body>
</html>
